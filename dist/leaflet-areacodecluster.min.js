!function(){"use strict";L.AreaCodeCluster=L.Layer.extend({options:{clusterMarkerFactory:function(e,t){var o=e.length,n=e.map((function(e){return e.getLatLng?e.getLatLng():e.getBounds().getCenter()})),a=n.reduce((function(e,t){return L.latLng(e.lat+t.lat/o,e.lng+t.lng/o)}),L.latLng(0,0)),r=L.latLngBounds(n),i=["area-code-cluster"];o<10?i.push("area-code-cluster-small"):o<100?i.push("area-code-cluster-medium"):i.push("area-code-cluster-large");var s=L.marker(a,{icon:L.divIcon({html:"<span>"+o+"</span>",className:i.join(" "),iconSize:L.point(40,40)})});return t.length>0&&s.bindTooltip(t),r.isValid()&&(s._rectangle=L.rectangle(r),s.on("mouseover",(function(){this._map.addLayer(this._rectangle)})),s.on("mouseout remove",(function(){this._map.removeLayer(this._rectangle)}))),r.isValid()?s.on("click",(function(){var e=this._map._getBoundsCenterZoom(r).zoom,t=this._map.getZoom();e<=t?this._map.setView(this.getLatLng(),t+1):this._map.fitBounds(r)})):s.on("click",(function(){this._map.setView(this.getLatLng(),this._map.getZoom()+1)})),s},areaCodeModifier:function(e,t){return e<=1?"":e<=6?t:null}},initialize:function(e,t){var o=this;L.Util.setOptions(this,t),this._source={},this._layers=[],e.forEach((function(e){o.addLayer(e)}))},addLayer:function(e){var t=e.options.areaCode;if(t&&(e.getLatLng||e.getBounds)){var o=this._source[t]||(this._source[t]=[]);-1===o.indexOf(e)&&(o.push(e),this._map&&this._onZoomEnd())}return this},removeLayer:function(e){var t=0;return Object.values(this._source).forEach((function(o){var n=o.indexOf(e);-1!==n&&(o.splice(n,1),t++)})),this._map&&t>0&&this._onZoomEnd(),this},getEvents:function(){return{moveend:this._onMoveEnd,zoomend:this._onZoomEnd,viewreset:this._onZoomEnd,zoomlevelschange:this._onZoomEnd}},onAdd:function(e){this._onZoomEnd()},onRemove:function(e){this._layers.forEach((function(t){e.hasLayer(t)&&e.removeLayer(t)})),this._layers=[]},_onMoveEnd:function(){if(this._map){var e=this._map,t=e.getBounds();this._layers.forEach((function(o){(o.getLatLng?t.contains(o.getLatLng()):t.intersects(o.getBounds()))?e.hasLayer(o)||e.addLayer(o):e.hasLayer(o)&&e.removeLayer(o)}))}},_onZoomEnd:function(){var e=this;if(this._map){var t=this._map,o=this._map.getZoom(),n=this._layers,a=[],r={};Object.keys(this._source).forEach((function(t){var n=e._source[t],i=e.options.areaCodeModifier(o,t);if(null===i||!1===i||void 0===i)Array.prototype.push.apply(a,n);else{var s=r[i]||(r[i]=[]);Array.prototype.push.apply(s,n)}})),n.forEach((function(e){t.hasLayer(e)&&-1===a.indexOf(e)&&t.removeLayer(e)})),Object.keys(r).forEach((function(t){var o=r[t],n=e.options.clusterMarkerFactory(o,t);a.push(n)})),this._layers=a,this._onMoveEnd()}}}),L.areaCodeCluster=function(e,t){return new L.AreaCodeCluster(e,t)}}();
