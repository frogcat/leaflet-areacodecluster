!function(){"use strict";var e;(e=window.L).AreaCodeCluster=e.FeatureGroup.extend({options:{pad:0},initialize:function(a,t,r){var o=this;this._areaCodeMap={},this._areaCodeList=[];var n=function(e,a){var t={markers:[],points:[],children:[]};e.label&&(t.label=e.label),e.areaCode&&(t.areaCode=e.areaCode),e.maxZoom&&(t.maxZoom=e.maxZoom),a&&(a.children.push(t),t.parent=a),o._areaCodeList.push(t),t.areaCode&&(Array.isArray(t.areaCode)?t.areaCode:[t.areaCode]).forEach((function(e){o._areaCodeMap[e]=t})),e.children&&e.children.forEach((function(e){n(e,t)}))};n(a,null),e.Util.setOptions(this,r),this._markers=[],t&&t.forEach((function(e){o.addMarker(e)})),e.FeatureGroup.prototype.initialize.call(this,[])},addMarker:function(e){var a=e.options.areacode;this._areaCodeMap[a]?this._areaCodeMap[a].markers.push(e):console.error(a+" not found",e)},onAdd:function(a){this._areaCodeList.forEach((function(e){e.points=[]})),this._areaCodeList.filter((function(e){return e.markers.length>0})).forEach((function(e){for(var a=e.markers.map((function(e){return e.getLatLng()})),t=e;t;)t.points=t.points.concat(a),t=t.parent})),this._areaCodeList.forEach((function(a){a.count=a.points.length,a.count>0&&(a.point=e.latLng(0,0),a.points.forEach((function(e){a.point.lat+=e.lat/a.count,a.point.lng+=e.lng/a.count})))})),this.refresh()},getEvents:function(){return{moveend:this.update,zoomend:this.refresh,viewreset:this.refresh,zoomlevelschange:this.refresh}},update:function(){var e=this;if(this._map){var a=this._map.getBounds().pad(this.options.pad);this._markers.forEach((function(t){a.contains(t.getLatLng())?e.hasLayer(t)||e.addLayer(t):e.hasLayer(t)&&e.removeLayer(t)}))}},refresh:function(){if(this._map){var a=this._map.getZoom(),t=[],r=function(o){if(o.maxZoom<a)t=t.concat(o.markers),o.children&&o.children.forEach(r);else{if(0===o.count)return;var n="marker-cluster-";o.count<10?n+="small":o.count<100?n+="medium":n+="large";var i=e.marker(o.point,{icon:e.divIcon({html:"<div><span>"+o.count+"</span></div>",className:"marker-cluster "+n,iconSize:e.point(40,40)})});o.count>1&&(i.rectangle=e.rectangle(o.points),i.on("mouseover",(function(){this._map.addLayer(i.rectangle)})),i.on("mouseout remove",(function(){this._map.removeLayer(i.rectangle)}))),i.on("click",(function(){this._map.setView(i.getLatLng(),o.maxZoom+1)}));var s=(o.id||"")+(o.label||"");s.length>0&&i.bindTooltip(s),t.push(i)}};this._areaCodeList.filter((function(e){return void 0===e.parent})).forEach(r),this.clearLayers(),this._markers=t,this.update()}}}),e.areaCodeCluster=function(a,t,r){return new e.AreaCodeCluster(a,t,r)}}();
