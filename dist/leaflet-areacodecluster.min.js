!function(){"use strict";var t;(t=window.L).AreaCodeCluster=t.FeatureGroup.extend({options:{pad:0},initialize:function(e,n,r){var a=this;this._areaCodeMap={},this._areaCodeList=[];var o=function(t){t.markers=[],t.points=[],a._areaCodeList.push(t),t.id&&(a._areaCodeMap[t.id]=t),t.children&&t.children.forEach((function(e){e.parent=t,o(e)}))};o(e),t.Util.setOptions(this,r),this._markers=[],n&&n.forEach((function(t){a.addMarker(t)})),t.FeatureGroup.prototype.initialize.call(this,[])},addMarker:function(t){var e=t.options.areacode;this._areaCodeMap[e]?this._areaCodeMap[e].markers.push(t):console.error(e+" not found",t)},onAdd:function(e){this._areaCodeList.forEach((function(t){t.points=[]})),this._areaCodeList.filter((function(t){return t.markers.length>0})).forEach((function(t){for(var e=t.markers.map((function(t){return t.getLatLng()})),n=t;n;)n.points=n.points.concat(e),n=n.parent})),this._areaCodeList.forEach((function(e){e.count=e.points.length,e.count>0&&(e.point=t.latLng(0,0),e.points.forEach((function(t){e.point.lat+=t.lat/e.count,e.point.lng+=t.lng/e.count})))})),this.refresh()},getEvents:function(){return{moveend:this.update,zoomend:this.refresh,viewreset:this.refresh,zoomlevelschange:this.refresh}},update:function(){var t=this;if(this._map){var e=this._map.getBounds().pad(this.options.pad);this._markers.forEach((function(n){e.contains(n.getLatLng())?t.hasLayer(n)||t.addLayer(n):t.hasLayer(n)&&t.removeLayer(n)}))}},refresh:function(){if(this._map){var e=this._map.getZoom(),n=[],r=function(a){if(a.maxZoom<e)n=n.concat(a.markers),a.children&&a.children.forEach(r);else{if(0===a.count)return;var o="marker-cluster-";a.count<10?o+="small":a.count<100?o+="medium":o+="large";var i=t.marker(a.point,{icon:t.divIcon({html:"<div><span>"+a.count+"</span></div>",className:"marker-cluster "+o,iconSize:t.point(40,40)})});a.count>1&&(i.rectangle=t.rectangle(a.points),i.on("mouseover",(function(){this._map.addLayer(i.rectangle)})),i.on("mouseout remove",(function(){this._map.removeLayer(i.rectangle)}))),i.on("click",(function(){this._map.setView(i.getLatLng(),a.maxZoom+1)}));var s=(a.id||"")+(a.label||"");s.length>0&&i.bindTooltip(s),n.push(i)}};this._areaCodeList.filter((function(t){return void 0===t.parent})).forEach(r),this.clearLayers(),this._markers=n,this.update()}}}),t.areaCodeCluster=function(e,n,r){return new t.AreaCodeCluster(e,n,r)}}();
